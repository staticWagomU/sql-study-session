---
marp: true
theme: orange-gradient
paginate: true
header: 'SQL勉強会 - 第1回'
---

<!-- _class: lead -->

# 第1回：準備と最初のクエリ
## DuckDBでスタート！

---

# 本日のゴール

<div class="check">DuckDBを起動し、データをn行表示できるようになる</div>

---

# 座学パート

## 1. DuckDBとは？
- 軽量で高速な<span class="accent">SQLデータベースエンジン</span>
- インストールが簡単で、すぐに使い始められる
- CSVファイルを直接読み込んでSQLが実行できる
- ブラウザベースのUIで視覚的に操作できる

---

## 2. DuckDBの起動方法

```bash
# プロジェクトディレクトリに移動
cd sql-study-session

# DuckDBを起動
duckdb -cmd "INSTALL ui;LOAD ui;CALL start_ui();"
```

<div class="tip">
起動に成功すると、ブラウザが自動的に開き、DuckDBのインターフェースが表示されます。
</div>

---

## 3. 画面の構成

画面は大きく<span class="accent">3つのエリア</span>に分かれています：

- **上部**：クエリ入力エリア（SQLを書く場所）
- **中央**：実行ボタン（▶ Run または Ctrl/Cmd + Enter）
- **下部**：結果表示エリア（実行結果が表形式で表示）

![Image](https://github.com/user-attachments/assets/3a8f9f2c-92b4-495d-9aef-63d9c1c334f8)
<!-- スクリーンショット: DuckDB GUI全体画面
     - 3つのエリアに番号や矢印で注釈
     - クエリエディタ、実行ボタン、結果エリアを明示 -->

---

## 4. 基本的なSQLコマンド

```sql
SELECT * FROM 'ファイル名' LIMIT 10;
```

この構文の意味：
- `SELECT *`：すべての列を選択
- `FROM 'ファイル名'`：どのファイルからデータを読むか
- `LIMIT 10`：最初の10行だけ表示
- `;`（セミコロン）：コマンドの終了を示す（<span class="accent">必須！</span>）

---

## 5. データファイルの構成

私たちが使うデータ：
- `customers.csv`：顧客データ（7人）
- `products.csv`：商品データ（5商品）
- `sales.csv`：売上データ（15件）

---

# DuckDB GUIの詳しい使い方

## クエリエディタの機能

### 基本的な入力
- **複数行の入力**：EnterキーでSQLを複数行に分けて書ける
- **インデント**：TabキーやSpaceキーで見やすく整形
- **コメント**：`-- コメント` または `/* コメント */`

```sql
-- これはコメントです
SELECT 
    customer_id,    -- 顧客ID
    product_id      -- 商品ID
FROM 'data/sales.csv';
```

<!-- スクリーンショット: クエリエディタ部分のクローズアップ
     - 複数行のSQL文が入力されている様子
     - コメントがハイライトされている様子
     - シンタックスハイライトが効いている様子 -->

---

## クエリの実行方法

### 実行操作
- **全体実行**：▶ Runボタン または `Ctrl/Cmd + Enter`
- **実行中断**：実行中のクエリは停止ボタンで中断可能

<!-- スクリーンショット: 実行ボタン周辺
     - Runボタンが強調されている
     - ショートカットキーの表示
     - （可能なら）実行中の停止ボタンも表示 -->

<div class="tip">
<strong>ヒント</strong>：長いクエリを書く時は、まず一部だけ実行して動作確認すると効率的！
</div>

---

## 結果表示エリアの操作

### 表示のカスタマイズ
- **列幅の調整**：列の境界をドラッグして幅を変更
- **データのコピー**：セルや行を選択してコピー（Ctrl/Cmd + C）
- **全選択**：結果全体を選択してExcelなどに貼り付け可能

<!-- スクリーンショット: 結果表示エリア
     - 列の境界にマウスカーソルが当たっている様子
     - 一部のセルが選択されている様子
     - 表形式でデータが表示されている様子 -->

### エクスポート機能
- **CSV形式**：結果をCSVファイルとして保存
- **クリップボード**：表形式のままコピー

<!-- スクリーンショット: エクスポートメニュー
     - CSVエクスポートオプション
     - その他のエクスポート形式（あれば） -->

---

## 便利な機能とショートカット

### よく使うショートカット
| 操作 | Windows/Linux | Mac |
|------|--------------|-----|
| クエリ実行 | Ctrl + Enter | Cmd + Enter |
| 全選択 | Ctrl + A | Cmd + A |
| コピー | Ctrl + C | Cmd + C |
| 貼り付け | Ctrl + V | Cmd + V |

### その他の便利機能
- **クエリ履歴**：過去に実行したクエリが保存される
- **自動補完**：テーブル名や列名の候補表示（環境による）

---

## エラーメッセージの見方

### よくあるエラーと対処法

```sql
-- エラー例：ファイルが見つからない
SELECT * FROM 'data/test.csv';
-- Error: Could not open file 'data/test.csv'
```

<!-- スクリーンショット: エラーメッセージの表示
     - 赤色でエラーメッセージが表示されている様子
     - エラーの内容が明確に見える
     - どの行でエラーが発生したかが分かる -->

<div class="warning">
エラーが出たら：
<ul>
<li>ファイルパスのスペルミスをチェック</li>
<li>セミコロン（;）の付け忘れを確認</li>
<li>クォート（'）の閉じ忘れを確認</li>
</ul>
</div>

---

## 画面レイアウトのカスタマイズ

### エリアのサイズ調整
- クエリエディタと結果表示の境界をドラッグしてサイズ変更
- より多くの結果を見たい時は結果エリアを広げる
- 長いクエリを書く時はエディタエリアを広げる

<!-- スクリーンショット: レイアウト調整
     - エリア間の境界線にマウスが当たっている様子
     - ドラッグ可能なことを示すカーソル
     - 調整前後の比較（2枚組でも可） -->

### 推奨設定
- 初心者：結果エリアを広めに（結果が見やすい）
- 慣れてきたら：バランスよく配置

---

# 演習パート

## 演習1：DuckDBの起動確認（全員で一緒に）

1. ターミナルで`pwd`コマンドを実行し、`sql-study-session`ディレクトリにいることを確認
2. DuckDBを起動：
   - Mac/Linux: `./start_duckdb_ui.sh`を実行
   - Windows: `start_duckdb_ui.cmd`を実行
3. ブラウザが自動的に開くことを確認
4. 画面の各エリアを確認

---

## 演習2：基本的な操作を試してみよう

### 2-1. クエリの入力と実行
1. クエリエディタに以下を入力（複数行で書いてみましょう）：
```sql
-- 売上データの最初の5件を表示
SELECT * 
FROM 'data/sales.csv' 
LIMIT 5;
```

2. `Ctrl/Cmd + Enter`で実行（またはRunボタンをクリック）

---

### 2-2. 結果の操作を試す

結果が表示されたら：
1. **列幅の調整**：列の境界をドラッグして見やすく調整
2. **データのコピー**：
   - 任意のセルをクリックして選択
   - `Ctrl/Cmd + C`でコピー
   - メモ帳やExcelに貼り付けてみる
3. **全選択とコピー**：結果全体を選択してコピー

<div class="tip">
結果はこのような表形式で表示されます：
<ul>
<li>customer_id：顧客ID（C001など）</li>
<li>product_id：商品ID（P001など）</li>
<li>quantity：購入数量</li>
<li>order_date：注文日</li>
</ul>
</div>

---

## 演習3：エラーメッセージを体験してみよう

### 3-1. わざとエラーを起こしてみる
```sql
-- セミコロンを忘れてみる
SELECT * FROM 'data/products.csv'
```
実行すると何が起きるか確認してみましょう。

### 3-2. 正しいクエリに修正
```sql
SELECT * FROM 'data/products.csv';
```
セミコロンを追加して再実行。5つの商品データが表示されます。

---

## 演習4：便利な機能を活用してみよう

### 4-1. 複数行で見やすく書く
```sql
-- 顧客データから3件だけ取得
SELECT 
    customer_id,
    customer_name,
    email
FROM 'data/customers.csv' 
LIMIT 3;
```

### 4-2. 結果の活用
1. 結果を確認
2. 画面レイアウトを調整（境界をドラッグ）
3. 必要に応じて結果をコピー＆ペースト

---

# 練習問題

## 1. LIMITを使わずに実行してみよう

```sql
SELECT * FROM 'data/sales.csv';
```
→ 全15件のデータが表示されることを確認

---

## 2. LIMIT 1でどうなるか確認

```sql
SELECT * FROM 'data/products.csv' LIMIT 1;
```
→ 最初の1行だけ表示される

---

## 3. エラーを体験してみよう

```sql
SELECT * FROM 'data/test.csv' LIMIT 5;
```

<div class="warning">
ファイルが存在しないというエラーメッセージが表示される
</div>

---

# 本日のまとめ

今日学んだこと：
- <span class="check">DuckDBの起動方法（`./start_duckdb_ui.sh` または `start_duckdb_ui.cmd`）</span>
- <span class="check">画面の3つのエリア（クエリ入力、実行、結果表示）</span>
- <span class="check">クエリエディタの操作（複数行入力、コメント、実行方法）</span>
- <span class="check">結果の操作（列幅調整、コピー、エクスポート）</span>
- <span class="check">便利なショートカット（Ctrl/Cmd + Enter で実行）</span>
- <span class="check">`SELECT * FROM 'ファイル名' LIMIT n;` の基本構文</span>
- <span class="check">セミコロン（`;`）の重要性</span>
- <span class="check">CSVファイルから直接データを読み込む方法</span>

---

## 便利な機能

- **自動補完**：入力中に候補が表示される場合がある
- **エラー表示**：構文エラーが分かりやすく表示される
- **結果のエクスポート**：結果をCSVなどで保存可能

---

# 次回予告

第2回では、必要な列だけを選んで表示する方法を学びます。
列名も見やすく、どの列を選ぶか視覚的に確認しながら進められます！

---

# 追加演習

## 問題1：異なるLIMIT値での表示

以下のLIMIT値で各ファイルを表示してみましょう：

```sql
-- sales.csvを8行表示
-- あなたの答えをここに書いてください

-- products.csvを2行だけ表示
-- あなたの答えをここに書いてください

-- customers.csvを全件表示（LIMITなし）
-- あなたの答えをここに書いてください
```

---

## 問題2：ファイルパスの理解

以下のクエリを実行し、エラーを確認してください：

```sql
-- 1. パスの区切り文字を間違える
SELECT * FROM 'data\sales.csv' LIMIT 5;

-- 2. ファイル名を間違える
SELECT * FROM 'data/sale.csv' LIMIT 5;

-- 3. 拡張子を忘れる
SELECT * FROM 'data/sales' LIMIT 5;
```

---

## 問題3：複数のクエリを連続実行

以下のクエリを順番に実行し、結果を比較してください：

```sql
-- 最初のクエリ
SELECT * FROM 'data/customers.csv' LIMIT 1;

-- 2番目のクエリ
SELECT * FROM 'data/customers.csv' LIMIT 2;

-- 3番目のクエリ
SELECT * FROM 'data/customers.csv' LIMIT 3;
```

---

## 問題4：データの行数を推測

LIMITを使わずに各ファイルを表示し、それぞれ何行あるか数えてください：
- customers.csv: ＿＿行
- products.csv: ＿＿行
- sales.csv: ＿＿行

---

## 🎯 チャレンジ問題

```sql
-- sales.csvの最後の5行だけを表示するにはどうすればよいでしょうか？
-- ヒント：第4回で学ぶORDER BYを先取りして使ってみましょう
```

---

# FAQ

**Q: ブラウザが開かない**
A: ファイアウォールやセキュリティソフトが原因の可能性があります。表示されるURLを手動でブラウザに入力してください。

**Q: クエリが実行されない**
A: セミコロン（`;`）を忘れていませんか？また、実行ボタンをクリックするか、Ctrl/Cmd + Enterを押してください。

**Q: 文字化けしている**
A: ブラウザの文字エンコーディングがUTF-8になっているか確認してください。
